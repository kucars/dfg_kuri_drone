<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>
    </title>

    <link href="./lib/ionic/css/ionic.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">

    <!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above
    <link href="./css/ionic.app.css" rel="stylesheet">
    -->

    <!-- ionic/angularjs js -->
    <script src="./lib/ionic/js/ionic.bundle.js"></script>

    <!-- cordova script (this will be a 404 during development) -->
    <script src="cordova.js"></script>

    <!-- your app's js -->
    <script src="./js/app.js"></script>
    <script src="./js/controllers.js"></script>
    <script src="./js/services.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js"></script>
    <script src="./js/eventemitter2.min.js"></script>
	<script src="./js/roslib.js"></script>
	<script>
		  // Connecting to ROS
		  // -----------------
		  var ros = new ROSLIB.Ros();

		  // If there is an error on the backend, an 'error' emit will be emitted.
		  ros.on('error', function(error) {
			document.getElementById('connecting').style.display = 'none';
			document.getElementById('connected').style.display = 'none';
			document.getElementById('closed').style.display = 'none';
			document.getElementById('error').style.display = 'inline';
			console.log(error);
		  });

		  // Find out exactly when we made a connection.
		  ros.on('connection', function() {
			console.log('Connection made!');
			document.getElementById('connecting').style.display = 'none';
			document.getElementById('error').style.display = 'none';
			document.getElementById('closed').style.display = 'none';
			document.getElementById('connected').style.display = 'inline';
		  });

		  ros.on('close', function() {
			console.log('Connection closed.');
			document.getElementById('connecting').style.display = 'none';
			document.getElementById('connected').style.display = 'none';
			document.getElementById('closed').style.display = 'inline';
		  });

		  // Create a connection to the rosbridge WebSocket server.
		  ros.connect('ws://10.0.0.110:8080');

		  // Publishing a Topic
		  // ------------------

		  // First, we create a Topic object with details of the topic's name and message type.
		  var cmdVel = new ROSLIB.Topic({
			ros : ros,
			name : '/cmd_vel',
			messageType : 'geometry_msgs/Twist'
		  });

		  // Then we create the payload to be published. The object we pass in to ros.Message matches the
		  // fields defined in the geometry_msgs/Twist.msg definition.
		  var twist = new ROSLIB.Message({
			linear : {
			  x : 0.1,
			  y : 0.2,
			  z : 0.3
			},
			angular : {
			  x : -0.1,
			  y : -0.2,
			  z : -0.3
			}
		  });

		  // And finally, publish.
		  cmdVel.publish(twist);

		  //Subscribing to a Topic
		  //----------------------

		  // Like when publishing a topic, we first create a Topic object with details of the topic's name
		  // and message type. Note that we can call publish or subscribe on the same topic object.
		  var listener = new ROSLIB.Topic({
			ros : ros,
			name : '/listener',
			messageType : 'std_msgs/String'
		  });

		  // Then we add a callback to be called every time a message is published on this topic.
		  listener.subscribe(function(message) {
			console.log('Received message on ' + listener.name + ': ' + message.data);

			// If desired, we can unsubscribe from the topic as well.
			listener.unsubscribe();
		  });

		  // Calling a service
		  // -----------------

		  // First, we create a Service client with details of the service's name and service type.
		  var addTwoIntsClient = new ROSLIB.Service({
			ros : ros,
			name : '/add_two_ints',
			serviceType : 'rospy_tutorials/AddTwoInts'
		  });

		  // Then we create a Service Request. The object we pass in to ROSLIB.ServiceRequest matches the
		  // fields defined in the rospy_tutorials AddTwoInts.srv file.
		  var request = new ROSLIB.ServiceRequest({
			a : 1,
			b : 2
		  });

		  // Finally, we call the /add_two_ints service and get back the results in the callback. The result
		  // is a ROSLIB.ServiceResponse object.
		  addTwoIntsClient.callService(request, function(result) {
			console.log('Result for service call on ' + addTwoIntsClient.name + ': ' + result.sum);
		  });

		  // Setting a param value
		  // ---------------------

		  ros.getParams(function(params) {
			console.log(params);
		  });

		  // First, we create a Param object with the name of the param.
		  var maxVelX = new ROSLIB.Param({
			ros : ros,
			name : 'max_vel_y'
		  });

		  //Then we set the value of the param, which is sent to the ROS Parameter Server.
		  maxVelX.set(0.8);
		  maxVelX.get(function(value) {
			console.log('MAX VAL: ' + value);
		  });

		  // Getting a param value
		  // ---------------------

		  var favoriteColor = new ROSLIB.Param({
			ros : ros,
			name : 'favorite_color'
		  });

		  favoriteColor.set('red');
		  favoriteColor.get(function(value) {
			console.log('My robot\'s favorite color is ' + value);
		  });
	</script>

  </head>
  <body ng-app="starter">
    <!--
      The nav bar that will be updated as we navigate between views.
    -->
    <ion-nav-bar class="bar-stable">
      <ion-nav-back-button>
      </ion-nav-back-button>
    </ion-nav-bar>
    <!--
      The views will be rendered in the <ion-nav-view> directive below
      Templates are in the /templates folder (but you could also
      have templates inline in this html file if you'd like).
    -->
    <ion-nav-view></ion-nav-view>
	<script id="raw.html" type="text/ng-template">
		<div class="modal">
			<div class="bar bar-header bar-calm">
				<button class="button" ng-click="closeModal()">
				back
				</button>
				<h1 class="title">Raw Streaming</h1>
			</div>
			<br />
			<br />
			<div class="list card">
				<img id="raw video" src="http://10.0.0.110:8181/stream?topic=/web_cam/image_raw">
				</img>
			</div>
		</div>
	</script>
	<script id="processed.html" type="text/ng-template">
		<div class="modal">
			<div class="bar bar-header bar-calm">
				<button class="button" ng-click="closeModal()">
				back
				</button>
				<h1 class="title">Processed Streaming</h1>
			</div>
			<br />
			<br />
			<div class="list card">
				<img id="video" src="http://10.0.0.110:8181/stream?topic=/site_violation_detection/image_raw">
			</div>
		</div>
	</script>
	<script id="ir.html" type="text/ng-template">
		<div class="modal">
			<div class="bar bar-header bar-calm">
				<button class="button" ng-click="closeModal()">
				back
				</button>
				<h1 class="title">IR Streaming</h1>
			</div>
			<br />
			<br />
			<div class="list card">
				<img id="video" src="http://10.0.0.110:8181/stream?topic=/camera/depth/image">
			</div>
		</div>
	</script>
	<script id="modal.html" type="text/ng-template">
		<div class="modal">
		  <div class="bar bar-header bar-calm">
		    <button class="button" ng-click="closeModal()">back</button>
		    <h1 class="title">Add Item</h1>
		  </div>
		  <br></br>
		  <br></br>
		  <form ng-submit="AddItem(data)">
		    <div class="list">
		      <div class="list list-inset">
		        <label class="item item-input">
		          <input type="text" placeholder="ToDo Item" ng-model="data.newItem">
		        </label>
		      </div>
		      <button class="button button-block button-positive" type="submit">
		        Add Item
		      </button>
		    </div>
		  </form>
		</div>
	</script>
  </body>
</html>
